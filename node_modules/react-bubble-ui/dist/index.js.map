{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React, { useState, useLayoutEffect, useRef } from \"react\";\nimport styles from \"./styles.module.css\";\n\nexport const defaultOptions = {\n  size: 200,\n  minSize: 20,\n  gutter: 16,\n  provideProps: false,\n  numCols: 6,\n  fringeWidth: 100,\n  yRadius: 200,\n  xRadius: 200,\n  cornerRadius: 100,\n  showGuides: false,\n  compact: false,\n  gravitation: 0,\n};\n\nexport default function BubbleElement(props) {\n  if (!props.children) {\n    return null;\n  }\n  let options = {};\n  Object.assign(options, defaultOptions);\n  Object.assign(options, props.options);\n  options.numCols = Math.min(options.numCols, props.children.length);\n  // console.log(options);\n\n  const minProportion = options.minSize / options.size;\n\n  const verticalPadding = `calc(50% - ${\n    options.yRadius +\n    options.size / 2 -\n    (options.cornerRadius * (1.414 - 1)) / 1.414\n  }px)`;\n  const horizontalPadding = `calc(50% - ${\n    options.xRadius +\n    options.size / 2 -\n    (options.cornerRadius * (1.414 - 1)) / 1.414\n  }px)`;\n\n  const scrollable = useRef(null);\n\n  let rows = [];\n  var colsRemaining = 0;\n  var evenRow = true;\n  for (var i = 0; i < props.children.length; i++) {\n    if (colsRemaining == 0) {\n      colsRemaining = evenRow ? options.numCols - 1 : options.numCols;\n      evenRow = !evenRow;\n      rows.push([]);\n    }\n    rows[rows.length - 1].push(props.children[i]);\n    colsRemaining--;\n  }\n  if (rows.length > 1) {\n    if (rows[rows.length - 1].length % 2 == rows[rows.length - 2].length % 2) {\n      rows[rows.length - 1].push(<div></div>); // dummy bubble\n    }\n  }\n\n  const [scrollTop, setScrollTop] = useState(0);\n  const [scrollLeft, setScrollLeft] = useState(0);\n\n  const handleScroll = (e) => {\n    if (e.target.className) {\n      setScrollTop(e.target.scrollTop);\n      setScrollLeft(e.target.scrollLeft);\n    }\n  };\n\n  // const handleResize = (e) => {\n  //   console.log('resize', e)\n  //   setElementHeight(container.current.clientHeight)\n  // }\n\n  useLayoutEffect(() => {\n    window.addEventListener(\"scroll\", handleScroll);\n\n    scrollable.current.scrollTo(\n      (scrollable.current.scrollWidth - scrollable.current.clientWidth) / 2,\n      (scrollable.current.scrollHeight - scrollable.current.clientHeight) / 2\n    );\n    return () => window.removeEventListener(\"scroll\", handleScroll);\n  }, []);\n\n  const interpolate = (actualMin, actualMax, val, targetMin, targetMax) => {\n    return (\n      ((val - actualMin) / (actualMax - actualMin)) * (targetMax - targetMin) +\n      targetMin\n    );\n  };\n\n  const getBubbleSize = (row, col) => {\n    const yOffset =\n      (options.size + options.gutter) * 0.866 * row -\n      options.size +\n      (options.cornerRadius * (1.414 - 1)) / 1.414 -\n      (options.yRadius - options.size);\n    //  - options.cornerRadius / 1.414;\n    const xOffset =\n      (options.size + options.gutter) * col +\n      ((options.numCols - rows[row].length) * (options.size + options.gutter)) /\n        2 -\n      options.size +\n      (options.cornerRadius * (1.414 - 1)) / 1.414 -\n      (options.xRadius - options.size);\n    // - options.cornerRadius / 1.414;\n    const dy = yOffset - scrollTop;\n    const dx = xOffset - scrollLeft;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    // let theta = Math.atan(dy / dx);\n    // if (dx < 0) theta += Math.PI;\n    let out = {\n      bubbleSize: 1,\n      translateX: 0,\n      translateY: 0,\n      distance: distance,\n    };\n    let distanceFromEdge = 0;\n    let isInCornerRegion = false;\n    if (Math.abs(dx) <= options.xRadius && Math.abs(dy) <= options.yRadius) {\n      // inner square\n      if (\n        Math.abs(dy) > options.yRadius - options.cornerRadius &&\n        Math.abs(dx) > options.xRadius - options.cornerRadius\n      ) {\n        // in corner region\n        const distToInnerCorner = Math.sqrt(\n          Math.pow(Math.abs(dy) - options.yRadius + options.cornerRadius, 2) +\n            Math.pow(Math.abs(dx) - options.xRadius + options.cornerRadius, 2)\n        );\n        if (distToInnerCorner > options.cornerRadius) {\n          // outside inner radius\n          distanceFromEdge = distToInnerCorner - options.cornerRadius;\n          isInCornerRegion = true;\n        }\n      }\n    } else if (\n      Math.abs(dx) <= options.xRadius + options.fringeWidth &&\n      Math.abs(dy) <= options.yRadius + options.fringeWidth\n    ) {\n      // outer square\n      if (\n        Math.abs(dy) > options.yRadius - options.cornerRadius &&\n        Math.abs(dx) > options.xRadius - options.cornerRadius\n      ) {\n        // in corner region\n        isInCornerRegion = true;\n        const distToInnerCorner = Math.sqrt(\n          Math.pow(Math.abs(dy) - options.yRadius + options.cornerRadius, 2) +\n            Math.pow(Math.abs(dx) - options.xRadius + options.cornerRadius, 2)\n        );\n        distanceFromEdge = distToInnerCorner - options.cornerRadius;\n        // distanceFromEdge = Math.min(\n        //   distToInnerCorner - options.cornerRadius,\n        //   options.fringeWidth\n        // );\n      } else {\n        distanceFromEdge = Math.max(\n          Math.abs(dx) - options.xRadius,\n          Math.abs(dy) - options.yRadius\n        );\n      }\n    } else {\n      // outside outer square\n      isInCornerRegion =\n        Math.abs(dy) > options.yRadius - options.cornerRadius &&\n        Math.abs(dx) > options.xRadius - options.cornerRadius;\n      if (isInCornerRegion) {\n        const distToInnerCorner = Math.sqrt(\n          Math.pow(Math.abs(dy) - options.yRadius + options.cornerRadius, 2) +\n            Math.pow(Math.abs(dx) - options.xRadius + options.cornerRadius, 2)\n        );\n        distanceFromEdge = distToInnerCorner - options.cornerRadius;\n      } else {\n        distanceFromEdge = Math.max(\n          Math.abs(dx) - options.xRadius,\n          Math.abs(dy) - options.yRadius\n        );\n      }\n    }\n\n    out.bubbleSize = interpolate(\n      0,\n      options.fringeWidth,\n      Math.min(distanceFromEdge, options.fringeWidth),\n      1,\n      minProportion\n    );\n\n    //handle magnitudes\n\n    const translationMag = options.compact\n      ? (options.size - options.minSize) / 2\n      : 0;\n    const interpolatedTranslationMag = interpolate(\n      0,\n      options.fringeWidth,\n      distanceFromEdge,\n      0,\n      translationMag\n    );\n\n    if (distanceFromEdge > 0 && distanceFromEdge <= options.fringeWidth) {\n      out.translateX = interpolatedTranslationMag;\n      out.translateY = interpolatedTranslationMag;\n    } else if (distanceFromEdge - options.fringeWidth > 0) {\n      const extra =\n        (Math.max(\n          0,\n          distanceFromEdge - options.fringeWidth - options.size / 2\n        ) *\n          options.gravitation) /\n        10;\n      out.translateX = translationMag + extra;\n      out.translateY = translationMag + extra;\n    }\n\n    if (isInCornerRegion) {\n      const cornerDx = Math.abs(dx) - options.xRadius + options.cornerRadius;\n      const cornerDy = Math.abs(dy) - options.yRadius + options.cornerRadius;\n      let theta = Math.atan(-cornerDy / cornerDx);\n      if (dx > 0) {\n        if (dy > 0) {\n          theta *= -1;\n        }\n      } else {\n        if (dy > 0) {\n          theta += Math.PI;\n        } else {\n          theta += Math.PI - 2 * theta;\n        }\n      }\n      out.translateX *= -Math.cos(theta);\n      out.translateY *= -Math.sin(theta);\n    } else if (\n      Math.abs(dx) > options.xRadius ||\n      Math.abs(dy) > options.yRadius\n    ) {\n      if (Math.abs(dx) > options.xRadius) {\n        out.translateX *= -Math.sign(dx);\n        out.translateY = 0;\n      } else {\n        out.translateY *= -Math.sign(dy);\n        out.translateX = 0;\n      }\n    }\n\n    return out;\n  };\n\n  return (\n    <div\n      className={props.className}\n      style={{\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        ...props.style,\n      }}\n    >\n      <div className={styles.container}>\n        {/* <p>{`scrollTop: ${scrollTop}`}</p>\n        <p>{`scrollLeft: ${scrollLeft}`}</p> */}\n        <div\n          className={styles.scrollable}\n          ref={scrollable}\n          onScroll={handleScroll}\n        >\n          <div\n            className={styles.horizontalSpacer}\n            style={{\n              height: verticalPadding,\n            }}\n          ></div>\n          <div\n            className={styles.rowContainer}\n            style={{\n              width:\n                options.size * options.numCols +\n                options.gutter * (options.numCols - 1),\n              paddingLeft: horizontalPadding,\n              paddingRight: horizontalPadding,\n            }}\n          >\n            {rows.map((row, i) => {\n              return (\n                <div\n                  className={styles.row}\n                  key={i}\n                  style={{\n                    marginTop:\n                      i > 0\n                        ? options.size * -0.134 + options.gutter * 0.866 // .134 is sqrt(3) - 1\n                        : 0,\n                  }}\n                >\n                  {row.map((comp, j) => {\n                    const {\n                      bubbleSize,\n                      translateX,\n                      translateY,\n                      distance,\n                    } = getBubbleSize(i, j);\n                    return (\n                      <div\n                        key={j}\n                        className={styles.bubbleContainer}\n                        style={{\n                          width: options.size,\n                          height: options.size,\n                          marginRight: options.gutter / 2,\n                          marginLeft: options.gutter / 2,\n                          transform: `translateX(${translateX}px) translateY(${translateY}px) scale(${bubbleSize})`,\n                        }}\n                      >\n                        {options.provideProps\n                          ? React.cloneElement(comp, {\n                              bubbleSize: bubbleSize * options.size,\n                              distanceToCenter: distance,\n                              maxSize: options.size,\n                              minSize: options.minSize,\n                            })\n                          : comp}\n                      </div>\n                    );\n                  })}\n                </div>\n              );\n            })}\n          </div>\n          <div\n            className={styles.horizontalSpacer}\n            style={{\n              height: verticalPadding,\n            }}\n          ></div>\n        </div>\n\n        {options.showGuides ? (\n          <div className={styles.guideContainer}>\n            <div\n              className={styles.guide}\n              style={{\n                height: options.yRadius * 2,\n                width: options.xRadius * 2,\n                borderRadius:\n                  options.shape == \"ellipse\" ? \"50%\" : options.cornerRadius,\n              }}\n            ></div>\n            <div\n              className={styles.guide}\n              style={{\n                height: (options.yRadius + options.fringeWidth) * 2,\n                width: (options.xRadius + options.fringeWidth) * 2,\n                borderRadius:\n                  options.shape == \"ellipse\"\n                    ? \"50%\"\n                    : options.cornerRadius + options.fringeWidth,\n              }}\n            ></div>\n            {/* <div\n              style={{\n                position: \"absolute\",\n                height: `100%`,\n                width: 1,\n                backgroundColor: \"#000\",\n                left: `50%`,\n                top: 0,\n              }}\n            ></div>\n            <div\n              style={{\n                position: \"absolute\",\n                width: `100%`,\n                height: 1,\n                backgroundColor: \"#000\",\n                top: `50%`,\n                left: 0,\n              }}\n            ></div> */}\n          </div>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n"],"names":["defaultOptions","size","minSize","gutter","provideProps","numCols","fringeWidth","yRadius","xRadius","cornerRadius","showGuides","compact","gravitation","BubbleElement","props","children","options","Object","assign","Math","min","length","minProportion","verticalPadding","horizontalPadding","scrollable","useRef","rows","colsRemaining","evenRow","i","push","React","useState","scrollTop","setScrollTop","scrollLeft","setScrollLeft","handleScroll","e","target","className","useLayoutEffect","window","addEventListener","current","scrollTo","scrollWidth","clientWidth","scrollHeight","clientHeight","removeEventListener","interpolate","actualMin","actualMax","val","targetMin","targetMax","getBubbleSize","row","col","yOffset","xOffset","dy","dx","distance","sqrt","out","bubbleSize","translateX","translateY","distanceFromEdge","isInCornerRegion","abs","distToInnerCorner","pow","max","translationMag","interpolatedTranslationMag","extra","cornerDx","cornerDy","theta","atan","PI","cos","sin","sign","display","justifyContent","alignItems","style","styles","container","horizontalSpacer","height","rowContainer","width","paddingLeft","paddingRight","map","marginTop","comp","j","bubbleContainer","marginRight","marginLeft","transform","cloneElement","distanceToCenter","maxSize","guideContainer","guide","borderRadius","shape"],"mappings":"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"}